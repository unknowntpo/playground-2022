#include "postgres.h"
#include "fmgr.h"
#include "optimizer/planner.h"
#include "nodes/parsenodes.h"


PG_MODULE_MAGIC;

static planner_hook_type prev_planner_hook = NULL;

static PlannedStmt *
plannerlog_hook(Query *parse, int cursorOptions, ParamListInfo boundParams)
{
    /* Log the decision made by the query planner here */
    ereport(NOTICE, (errmsg("planner decision: %s", nodeToString(parse))));

    /* Call the next planner hook */
    if (prev_planner_hook)
        return (*prev_planner_hook)(parse, cursorOptions, boundParams);
    else
        return standard_planner(parse, cursorOptions, boundParams);
}

void
_PG_init(void)
{
    /* Install the hook */
    prev_planner_hook = planner_hook;
    planner_hook = plannerlog_hook;
}
